<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Tonic Image Builder</title>
  <meta name="description" content="JavaScript library meant to gather algorithms for image generation.">

  <link rel="stylesheet" href="/tonic-image-builder/css/main.css">
  <link rel="stylesheet" href="assets_/css/shCore.css">
  <link rel="stylesheet" href="assets_/css/shThemeDefault.css">
  <link rel="stylesheet" href="assets_/css/main.css">
</head>

<body data-root-path="">

<header class="site-header">

    <nav class="mobile-nav show-on-mobiles">
        <a class="page-link" href="/tonic-image-builder/"><i class="fa fa-home fa-fw fa-lg"></i></a>
        <a class="page-link" href="/tonic-image-builder/docs/home"><i class="fa fa-book fa-fw fa-lg"></i></a>
        <a class="page-link" href="/tonic-image-builder/news"><i class="fa fa-newspaper-o fa-fw fa-lg"></i></a>
    </nav>
    <div class="wrapper">

        <a class="site-title center-on-mobiles" href="/">
            <img src="/tonic-image-builder/img/logo.png" height="40" alt="Logo">
            Tonic Image Builder
        </a>
        <nav class="site-nav hide-on-mobiles">
            <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </a>
            <div class="trigger">
                <a class="page-link" href="/tonic-image-builder/">Home</a>
                <a class="page-link" href="/tonic-image-builder/docs/home">Docs</a>
                <a class="page-link" href="/tonic-image-builder/news">News</a>
            </div>
        </nav>
    </div>

</header>

<div class="wrapper">
    <nav class="docs-nav hide-on-mobiles">
        <a href="#" class="menu-icon">
            <svg viewBox="0 0 18 15">
                <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
        </a>
    </nav>
</div>
<div id="wrapper">
   <div id="content">
<ul id="topnav">
    <li><a href="index.html">Index</a></li>
    <li><a href="#toc">TOC</a></li>
</ul>
<h1>CompositeImageBuilder</h1>

<p>This class definition let you create an ImageBuilder that let you process composite
datasets. The implementation rely on a single off-screen canvas to generate the
resulting image of a composite structure (rgb.jpg + composite.json).</p>

<h2>Table of Contents <a href="#toc" name="toc" class="deep-link">#</a></h2>

<ul>
<li><a href="#constructor">constructor()</a></li>
<li><a href="#update">update()</a></li>
<li><a href="#setPushMethodAsBuffer">setPushMethodAsBuffer()</a></li>
<li><a href="#setPushMethodAsImage">setPushMethodAsImage()</a></li>
<li><a href="#setPipelineQuery">setPipelineQuery()</a></li>
<li><a href="#render">render()</a></li>
<li><a href="#onImageReady">onImageReady()</a></li>
<li><a href="#TopicImageReady">TopicImageReady()</a></li>
<li><a href="#destroy">destroy()</a></li>
<li><a href="#* updateCompositeMap">* updateCompositeMap()</a></li>
<li><a href="#* updateOffsetMap">* updateOffsetMap()</a></li>
<li><a href="#* pushToFront">* pushToFront()</a></li>
<li><a href="#* pushToFrontAsImage">* pushToFrontAsImage()</a></li>
<li><a href="#* pushToFrontAsBuffer">* pushToFrontAsBuffer()</a></li>
</ul>

<h2>constructor(queryDataModel, pushAsBuffer) <a href="#constructor" id="constructor" class="deep-link">#</a></h2>

<p>Create an instance of a CompositeImageBuilder using the associated
<strong>queryDataModel</strong> that should be used to fetch the data.</p>

<p>Under the cover that will create an off-screen canvas for the image generation.
Then depending of the value of the flag <strong>pushAsBuffer</strong> the 'image-ready' notification
won't contain the same thing.</p>

<p>Below are the two event structure</p>

<pre class="brush:js">
// pushAsBuffer = true
var eventAsBuffer = {
    canvas: DOMElement,
    imageData: ImageDataFromCanvas,
    area: [0, 0, width, height],
    outputSize: [width, height],
    type: 'composite'
};

// pushAsBuffer = false
var eventAsImage = {
    url: 'data:image/png:ASDGFsdfgsdgf...'
    type: 'composite'
};
</pre>

<h2>update() <a href="#update" id="update" class="deep-link">#</a></h2>

<p>Trigger the fetching of the data (composite.json + rgb.jpg).</p>

<h2>setPushMethodAsBuffer() <a href="#setPushMethodAsBuffer" id="setPushMethodAsBuffer" class="deep-link">#</a></h2>

<p>Change the method to share the image to the outside world.
After that method get called, the notification event will look as follow.</p>

<pre class="brush:js">
{
    canvas: DOMElement,
    imageData: ImageDataFromCanvas,
    area: [0, 0, width, height],
    outputSize: [width, height],
    type: 'composite'
}
</pre>

<h2>setPushMethodAsImage() <a href="#setPushMethodAsImage" id="setPushMethodAsImage" class="deep-link">#</a></h2>

<p>Change the method to share the image to the outside world.
After that method get called, the notification event will look as follow.</p>

<pre class="brush:js">
{
    url: 'data:image/png:ASDGFsdfgsdgf...'
    type: 'composite'
}
</pre>

<h2>setPipelineQuery(pipelineQuery) <a href="#setPipelineQuery" id="setPipelineQuery" class="deep-link">#</a></h2>

<p>This method should be called each time the pipeline setting is changed.</p>

<p>The <strong>pipelineQuery</strong> is a String that encode the pipeline configuration such as
which layer is visible or not and which field should be rendered for a given layer.</p>

<p>The <strong>pipelineQuery</strong> is structured as follow.</p>

<pre class="brush:js">
var pipelineQuery = "A_BBCAD_EA";

// In that example we have the following setting
var layerSettings = [
    "A_", // Layer A is invisible
    "BB", // Layer B is using field B
    "CA", // Layer C is using field A
    "D_", // Layer D is invisible
    "EA"  // Layer E is using field A
];
</pre>

<h2>render() <a href="#render" id="render" class="deep-link">#</a></h2>

<p>Process the current set of loaded data and render it into the background canvas.
Once done, an event get triggered to let the application know that the image is
ready to be rendered/display somewhere.</p>

<h2>onImageReady(callback) : subscription <a href="#onImageReady" id="onImageReady" class="deep-link">#</a></h2>

<p>This allow the registration of a <strong>callback(data, envelope)</strong> function when the
actual generated image is ready.</p>

<h2>TopicImageReady() : 'image-ready' <a href="#TopicImageReady" id="TopicImageReady" class="deep-link">#</a></h2>

<p>Return the topic used for the notification of the image.</p>

<h2>destroy() <a href="#destroy" id="destroy" class="deep-link">#</a></h2>

<p>Free the internal resources of the current instance.</p>

<h2>* updateCompositeMap(query, composite) <a href="#* updateCompositeMap" id="* updateCompositeMap" class="deep-link">#</a></h2>

<p>Internal function used to update the composite map for faster rendering.</p>

<h2>* updateOffsetMap(pipelineQuery) <a href="#* updateOffsetMap" id="* updateOffsetMap" class="deep-link">#</a></h2>

<p>Internal function used to update the offset map based on the Pipeline configuration.
The <strong>pipelineQuery</strong> is a String that encode the pipeline configuration such as
which layer is visible or not and which field should be rendered for a given layer.</p>

<h2>* pushToFront(width, height) <a href="#* pushToFront" id="* pushToFront" class="deep-link">#</a></h2>

<p>Trigger the event notification that the image ready. This will call the proper
method to either send the ImageData or an ImageURL.</p>

<h2>* pushToFrontAsImage(width, height) <a href="#* pushToFrontAsImage" id="* pushToFrontAsImage" class="deep-link">#</a></h2>

<p>Method called as <strong>pushToFront</strong> when <strong>setPushMethodAsImage()</strong> is used.</p>

<h2>* pushToFrontAsBuffer(width, height) <a href="#* pushToFrontAsBuffer" id="* pushToFrontAsBuffer" class="deep-link">#</a></h2>

<p>Method called as <strong>pushToFront</strong> when setPushMethodAsBuffer()__ is used.</p>
        </div>
        <script src="assets_/js/lib/jquery.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shCore.js"></script>
        <script src="assets_/js/lib/syntax-highlighter/shAutoloader.js"></script>
        <script src="assets_/js/main.js"></script>
    </body>
</html>
